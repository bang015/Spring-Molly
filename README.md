<img src="https://github.com/Jeongseonil/anesi/assets/137017329/53034a7c-d92b-4d0a-a415-de4e158e983c"  width="200"/>
<h2>🔎 프로젝트 정보</h2>
<div><b>📆 2023.12.19 ~ 2024.03.22 (94일)</b></div>
<br>
<div><b>배포 주소</b> : https://molly.n-e.kr/</div>
<ui>테스트 계정
 <li>email : test11@naver.com</li>
<li>password : qwaszx11</li>
</ui>
<br>

### [프로젝트 구조]

![단락 텍스트 (1)](https://github.com/user-attachments/assets/22576f96-c398-4738-a69f-816bf067de00)

### Trouble Shooting
| **구분**         | **내용** 
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| **문제 상황**    | 웹소켓 초기 연결 시에만 JWT를 검증했으나, Access Token 유효기간 만료 후에도 웹소켓 연결이 유지되어 인증 없이 채팅이 가능해지는 보안 문제가 발생했습니다.   |
| **원인**         | - 웹소켓은 연결이 유지되는 동안 인증을 반복적으로 검증하지 않음. <br> - Access Token 유효기간이 짧아 만료 상황이 빈번하게 발생.                        |
| **해결 방법**    | 1. **Channel Interceptor를 통한 메시지 검증** <br> - 메시지를 보낼 때마다 JWT를 검증하고 만료 시 클라이언트에 에러 메시지 전송. <br> - 클라이언트는 에러 메시지에 따라 토큰 재발급 및 웹소켓 재연결 처리. <br> <br> 2. **Redux를 활용한 상태 관리** <br> - 웹소켓 연결 및 해제 시 `connect` 상태값 업데이트. <br> - 기존 구독 중인 채널을 재구독하여 실시간 채팅 안정성 확보. <br> <br> 3. **Pending Messages 리스트 구현** <br> - 전송 실패한 메시지를 저장하고, 웹소켓 재연결 후 다시 전송. |
<br>

| **문제 상황**    | EC2와 Nginx를 사용해 배포한 웹 애플리케이션에서 **웹소켓이 1분 동안 트래픽이 없으면 연결이 끊어지는 문제**가 발생했습니다.                |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| **원인**         | - 웹소켓은 기본적으로 트래픽이 없는 경우 연결을 유지하지 않습니다. <br> - Nginx의 기본 설정(`proxy_read_timeout`)이 60초로 제한되어 타임아웃 발생. |
| **해결 방법**    | 1. **하트비트를 이용한 Ping-Pong 메시지 구현** <br> - 클라이언트와 서버 간 주기적으로 `ping` 및 `pong` 메시지를 교환하여 연결 유지. <br> <br> 2. **타임아웃 설정 최적화** <br> - Nginx에서 `proxy_read_timeout` 값을 충분히 증가시켜 하트비트로 연결 유지 가능하도록 설정.                     |

자세한 내용은 frontend, backend 레포지토리에서 봐주시면 감사하겠습니다.
<li>
    [FE] : https://github.com/bang015/Molly-frontend
</li>
<li>
    [BE] : https://github.com/bang015/Molly-backend-spring
</li>
<br>
